cmake_minimum_required(VERSION 3.10)

# Add simple test executable (basic protocol constants only)
add_executable(simple_test simple_test.cpp)
target_include_directories(simple_test PRIVATE ../include)
set_property(TARGET simple_test PROPERTY CXX_STANDARD 17)
set_property(TARGET simple_test PROPERTY CXX_STANDARD_REQUIRED ON)

# Add State Machine Test
add_executable(test_state_machines test_state_machines.cpp ../src/core/gptp_state_machines.cpp ../src/core/gptp_clock.cpp ../src/core/path_delay_calculator.cpp)
target_include_directories(test_state_machines PRIVATE ../include)
set_property(TARGET test_state_machines PROPERTY CXX_STANDARD 17)
set_property(TARGET test_state_machines PROPERTY CXX_STANDARD_REQUIRED ON)

# Add BMCA Tests
add_executable(test_bmca test_bmca.cpp ../src/core/bmca.cpp)
target_include_directories(test_bmca PRIVATE ../include)
set_property(TARGET test_bmca PROPERTY CXX_STANDARD 17)
set_property(TARGET test_bmca PROPERTY CXX_STANDARD_REQUIRED ON)

# Add Clock Servo Tests (using portable timer)
# Note: Removed chrono dependency to focus on core servo logic
add_executable(test_clock_servo test_clock_servo.cpp ../src/core/clock_servo.cpp)
target_include_directories(test_clock_servo PRIVATE ../include)
set_property(TARGET test_clock_servo PROPERTY CXX_STANDARD 17)
set_property(TARGET test_clock_servo PROPERTY CXX_STANDARD_REQUIRED ON)

# Add Message Serialization Test
add_executable(test_message_serialization test_message_serialization.cpp)
target_include_directories(test_message_serialization PRIVATE ../include)
set_property(TARGET test_message_serialization PROPERTY CXX_STANDARD 17)
set_property(TARGET test_message_serialization PROPERTY CXX_STANDARD_REQUIRED ON)

# Link winsock2 on Windows for network byte order functions
if(WIN32)
  target_link_libraries(test_bmca ws2_32)
  target_link_libraries(test_message_serialization ws2_32)
endif()

# On Linux, might need to link pthread for some tests
if(UNIX AND NOT APPLE)
  target_link_libraries(test_state_machines pthread)
  target_link_libraries(test_bmca pthread)
  target_link_libraries(test_clock_servo pthread)
endif()
